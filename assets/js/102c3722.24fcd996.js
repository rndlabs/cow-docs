"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[3527],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),i=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=i(a),f=n,m=p["".concat(s,".").concat(f)]||p[f]||h[f]||l;return a?r.createElement(m,o(o({ref:t},u),{},{components:a})):r.createElement(m,o({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,o=new Array(l);o[0]=f;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[p]="string"==typeof e?e:n,o[1]=c;for(var i=2;i<l;i++)o[i]=a[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}f.displayName="MDXCreateElement"},2974:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>i});var r=a(7462),n=(a(7294),a(3905));const l={},o="Balancer External Balances",c={unversionedId:"smart-contracts/vault-relayer/balancer-external-balances",id:"smart-contracts/vault-relayer/balancer-external-balances",title:"Balancer External Balances",description:"The first mechanism that the Vault relayer contract can use to withdraw user ERC20 tokens is through Vault external balances. This works by having an ERC20 allowance for the Balancer Vault, and a relayer approval for the Vault relayer contract.",source:"@site/docs/3_smart-contracts/vault-relayer/2_balancer-external-balances.md",sourceDirName:"3_smart-contracts/vault-relayer",slug:"/smart-contracts/vault-relayer/balancer-external-balances",permalink:"/cow-docs/docs/smart-contracts/vault-relayer/balancer-external-balances",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3_smart-contracts/vault-relayer/2_balancer-external-balances.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Vault relayer",permalink:"/cow-docs/docs/smart-contracts/vault-relayer/introduction"},next:{title:"Balancer Internal Balances",permalink:"/cow-docs/docs/smart-contracts/vault-relayer/balancer-internal-balances"}},s={},i=[],u={toc:i},p="wrapper";function h(e){let{components:t,...a}=e;return(0,n.kt)(p,(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"balancer-external-balances"},"Balancer External Balances"),(0,n.kt)("p",null,"The first mechanism that the Vault relayer contract can use to withdraw user ERC20 tokens is through Vault external balances. This works by having an ERC20 allowance for the Balancer Vault, and a relayer approval for the Vault relayer contract."),(0,n.kt)("p",null,"This allowance and approval combination allows the Vault relayer contract to transfer ERC20 tokens through the Vault. Roughly speaking, the process works in the following way:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Vault relayer request to the Balancer Vault an ERC20 transfer from the user account to the Settlement contract")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The Balancer Vault verifies that the vault relayer contract is:"),(0,n.kt)("p",{parentName:"li"},"a. Authorized by Balancer governance to act as a relayer"),(0,n.kt)("p",{parentName:"li"},"b. The user has set an approval for that specific relayer")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The Balancer Vault issues an ERC20 transfer from the user account to the Settlement contract using the Vault's existing ERC20 allowance"))),(0,n.kt)("p",null,"This system for withdrawing user funds has several advantages such as :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"It can reuse existing Vault ERC20 allowances and doesn't require new ones specific to the CoW protocol."),(0,n.kt)("li",{parentName:"ul"},"Upgrades to the CoW protocol contract would only require a single relayer approval for all tokens instead of individual ERC20 approvals for each token being traded."),(0,n.kt)("li",{parentName:"ul"},"The Vault relayer approval can be revoked by a single transaction to the Vault instead of multiple transactions to each ERC20 token for which the user wants to remove the approval.")),(0,n.kt)("p",null,'Orders with the sell token balance flag set to "external" will withdraw using this process.'))}h.isMDXComponent=!0}}]);