"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[2638],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(r),m=o,h=p["".concat(c,".").concat(m)]||p[m]||d[m]||a;return r?n.createElement(h,i(i({ref:t},u),{},{components:r})):n.createElement(h,i({ref:t},u))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},3732:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const a={},i="3. Signing the order",s={unversionedId:"tutorials/how-to-submit-orders-via-the-api/signing-the-order",id:"tutorials/how-to-submit-orders-via-the-api/signing-the-order",title:"3. Signing the order",description:"We will resume the example from above, setting the validity (Unix timestamp) to August 4th 2021. We use keccak(GPv2 Place Order Tutorial) as appData (you can use your individual 32 bytes to identify the \u201csource\u201d of your orders).",source:"@site/docs/5_tutorials/how-to-submit-orders-via-the-api/4_signing-the-order.md",sourceDirName:"5_tutorials/how-to-submit-orders-via-the-api",slug:"/tutorials/how-to-submit-orders-via-the-api/signing-the-order",permalink:"/cow-docs/docs/tutorials/how-to-submit-orders-via-the-api/signing-the-order",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/5_tutorials/how-to-submit-orders-via-the-api/4_signing-the-order.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"2. Get a Quote",permalink:"/cow-docs/docs/tutorials/how-to-submit-orders-via-the-api/query-the-fee-endpoint"},next:{title:"4. Placing the order",permalink:"/cow-docs/docs/tutorials/how-to-submit-orders-via-the-api/placing-the-order"}},c={},l=[{value:"<strong>Security notice:</strong>",id:"security-notice",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...r}=e;return(0,o.kt)(p,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"3-signing-the-order"},"3. Signing the order"),(0,o.kt)("p",null,"We will resume the example from above, setting the validity (Unix timestamp) to ",(0,o.kt)("a",{parentName:"p",href:"https://www.epochconverter.com/?q=1628035200"},"August 4th 2021"),". We use ",(0,o.kt)("inlineCode",{parentName:"p"},"keccak(GPv2 Place Order Tutorial)")," as appData (you can use your individual 32 bytes to identify the \u201csource\u201d of your orders)."),(0,o.kt)("p",null,"Our TypeScript library provides a convenient way to create valid signatures for your order."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'import {\n  domain,\n  Order,\n  SigningScheme,\n  signOrder,\n} from "@gnosis.pm/gp-v2-contracts"\n\nconst [trader] = await ethers.getSigners();\nconst order = {\n    sellToken: 0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48,\n    buyToken: 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2,\n    sellAmount: 10000000000,\n    buyAmount: 4959721654652700610,\n    validTo: 1628035200,\n    appData: 0xf785fae7a7c5abc49f3cd6a61f6df1ff26433392b066ee9ff2240ff1eb7ab6e4,\n    feeAmount: 14075734,\n    kind: OrderKind.SELL,\n    partiallyFillable: false,\n    receiver: ethers.constants.AddressZero,\n  }\nconst raw_signature = await signOrder(\n      domain(1, \u201d0x9008D19f58AAbD9eD0D60971565AA8510560ab41\u201d),\n      order,\n      trader,\n      SigningScheme.ETHSIGN\n    );\n// Needed to turn the three part object into a single bytestring\nconst signature = ethers.utils.joinSignature(rawSignature.data);\n')),(0,o.kt)("p",null,"If you are using a different programming language you may have to write your own signing logic. Here are some pointers:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/gnosis/gp-v2-services/blob/d76f23b867e8dbb201f51736c9666e9b18d1086e/model/src/order.rs#L166"},"A reference implementation in rust")," (the domain separator can be queried from the ",(0,o.kt)("a",{parentName:"li",href:"https://etherscan.io/address/0x9008D19f58AAbD9eD0D60971565AA8510560ab41#readContract"},"Settlement Contract"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://pastebin.com/cKXUz0SW"},"A sample trading bot in python")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://pastebin.com/r787C2wT"},"A sample trading bot in go"))),(0,o.kt)("p",null,"The ultimate source of truth for signature verification is the smart contract\u2019s implementation of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-contracts/blob/main/src/contracts/libraries/GPv2Order.sol#L134"},"order digest")," and how it gets verified given ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-contracts/blob/main/src/contracts/mixins/GPv2Signing.sol#L141"},"different signing schemes"),"."),(0,o.kt)("h2",{id:"security-notice"},(0,o.kt)("strong",{parentName:"h2"},"Security notice:")),(0,o.kt)("p",null,"Do not sign orders with simultaneously ",(0,o.kt)("inlineCode",{parentName:"p"},"sellAmount == 0"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"buyAmount == 0"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"partiallyFillable == false"),"."),(0,o.kt)("p",null,"Because of a known issue in the contracts, such orders can be settled unlimited times, which means that any solver could take the ",(0,o.kt)("a",{parentName:"p",href:"../../overview/definitions"},"protocol fee"),' amount multiple times. There is normally no reason to generate such "empty" order. However, you should consider this case if you are signing orders that come from potentially untrusted sources.'))}d.isMDXComponent=!0}}]);