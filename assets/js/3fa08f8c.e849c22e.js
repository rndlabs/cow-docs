"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[1117],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>h});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(r),u=a,h=p["".concat(s,".").concat(u)]||p[u]||m[u]||i;return r?n.createElement(h,o(o({ref:t},d),{},{components:r})):n.createElement(h,o({ref:t},d))}));function h(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=r[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},6131:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=r(7462),a=(r(7294),r(3905));const i={},o="Settlement Contract",l={unversionedId:"smart-contracts/settlement-contract/introduction",id:"smart-contracts/settlement-contract/introduction",title:"Settlement Contract",description:"Settlement",source:"@site/docs/3_smart-contracts/settlement-contract/1_introduction.md",sourceDirName:"3_smart-contracts/settlement-contract",slug:"/smart-contracts/settlement-contract/introduction",permalink:"/cow-docs/docs/smart-contracts/settlement-contract/introduction",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/3_smart-contracts/settlement-contract/1_introduction.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Settlement",permalink:"/cow-docs/docs/category/settlement"},next:{title:"Signature Schemes",permalink:"/cow-docs/docs/smart-contracts/settlement-contract/signature-schemes"}},s={},c=[{value:"Settlement",id:"settlement",level:4}],d={toc:c},p="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(p,(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"settlement-contract"},"Settlement Contract"),(0,a.kt)("h4",{id:"settlement"},"Settlement"),(0,a.kt)("p",null,"A settlement comprises a list of traded tokens with their corresponding price in the batch, a list of trades to execute, and a list of interactions."),(0,a.kt)("p",null,"A solver monitors the on-chain liquidity and the orders that are available for being matched for then determining the clearing prices of the settlement, which orders will be included, and which extra liquidity is necessary from the blockchain."),(0,a.kt)("p",null,"Normally, all orders in a settlement are settled with uniform clearing prices, which means that every user receives the same price for the same token."),(0,a.kt)("p",null,"If the transaction does not revert, each order will be executed during a settlement and the user will receive the desired token after the settlement."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1.Interactions")),(0,a.kt)("p",null,"Interactions allow solvers to execute arbitrary calls to any on-chain contract."),(0,a.kt)("p",null,"Normally, they are used to interact with other on-chain liquidity providers, for example, to make a swap call to Uniswap."),(0,a.kt)("p",null,"They can also be used for other purposes: for example, an interaction can be used to approve Uniswap for trading with the tokens stored in the settlement contract, as well as withdrawing the accumulating ",(0,a.kt)("a",{parentName:"p",href:"../../overview/definitions"},"protocol fees")," from the contracts when the amount becomes too large."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2.Trades")),(0,a.kt)("p",null,"Trades contain a description of the users' orders, a signature for verifying its validity, and the executed amount (for partially fillable orders)."),(0,a.kt)("p",null,"The contract decodes the order parameters from the trade."),(0,a.kt)("p",null,"The parameters of the order are verified for validity:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The signature for the order matches the user's address"),(0,a.kt)("li",{parentName:"ul"},"The order is not expired"),(0,a.kt)("li",{parentName:"ul"},"The order was not previously filled"),(0,a.kt)("li",{parentName:"ul"},"The current prices are equal to or better than what is specified in the order")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3.Order struct")),(0,a.kt)("p",null,"Here is a complete list of the parameters of a GPv2 order and the corresponding type. This is the object that a user signs to validate its order."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Sell Token:")," the address of the token that is sold"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Buy Token:")," the address of the token that is bought"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Sell Amount:")," the amount of ",(0,a.kt)("inlineCode",{parentName:"li"},"sellToken")," that is sold in wei"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Buy Amount:")," the amount of ",(0,a.kt)("inlineCode",{parentName:"li"},"buyToken")," that is bought in wei"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Receiver:")," the address that will receive the proceedings of the trade. If this field is zero (the zero address ",(0,a.kt)("inlineCode",{parentName:"li"},"0x00...0"),"), then the user who signed the trade is going to receive the funds"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Valid To:")," the timestamp (in seconds) until which the order is valid"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"App Data:")," extra information about the order. It is ignored by the smart contract outside of signature verification, but may be used off-chain for information on the order's origin or for referrals"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Fee Amount:")," the amount of protocol fees paid in ",(0,a.kt)("inlineCode",{parentName:"li"},"sellToken")," wei."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Kind:")," either ",(0,a.kt)("inlineCode",{parentName:"li"},"sell")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"buy")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Partially Fillable:")," whether the order is partially fillable or fill-or-kill. (For the moment this is always FALSE as its not enabled yet)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Sell Token Balance:")," from where the sell token balance is withdrawn. It can be ",(0,a.kt)("inlineCode",{parentName:"li"},"erc20")," (directly from the user's ERC-20 balance), ",(0,a.kt)("inlineCode",{parentName:"li"},"external")," (from the user's ERC-20 balancer through Balancer's vault), or ",(0,a.kt)("inlineCode",{parentName:"li"},"internal")," (from the user's Balancer internal balance)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Buy Token Balance:")," to where the buy token is deposited. It can be ",(0,a.kt)("inlineCode",{parentName:"li"},"erc20")," (directly to the user's ERC-20 balance) or ",(0,a.kt)("inlineCode",{parentName:"li"},"internal")," (to the user's Balancer internal balance)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"SigningScheme:")," The signature scheme to use when signing the order. CoW Protocol allows various signing schemes to support different wallet kinds:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"eip712"),": Use the EIP-712 signing scheme exactly as specified ",(0,a.kt)("a",{parentName:"li",href:"https://eips.ethereum.org/EIPS/eip-712"},"in the EIP"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ethsign"),": Use the ",(0,a.kt)("inlineCode",{parentName:"li"},"eth_sign")," Ethereum message signature of the EIP-712 order \u201cstruct hash\u201d (this is defined in the EIP linked above)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"eip1271"),": Use ERC-1271 signature for the order. The order hash will be the EIP-712 order \u201cstruct hash\u201d (defined above)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"presign"),": Execute a transaction to the Settlement contract to indicate that an order is signed. This can be use as a fallback solution if no other signing schemes are supported by the trader."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Signature:")," The signature bytes. For ECDSA signatures (",(0,a.kt)("inlineCode",{parentName:"li"},"eip712")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"ethsign"),") this just the the signature encoded as 65 bytes: ",(0,a.kt)("inlineCode",{parentName:"li"},"r || s || v"),". For ",(0,a.kt)("inlineCode",{parentName:"li"},"eip1271"),", this is the signature bytes to pass in at signature verification. This is ERC-1271 implementation defined and largely depends on the signing smart contract. For ",(0,a.kt)("inlineCode",{parentName:"li"},"presign"),", this is the empty bytes ",(0,a.kt)("inlineCode",{parentName:"li"},"0x"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"From:")," The Address that submits the order and authorizes the full sellAmount to be traded once executed.")))}m.isMDXComponent=!0}}]);