"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[4125],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var r=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,o=function(e,t){if(null==e)return{};var a,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=r.createContext({}),c=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},d=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},h="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,o=e.mdxType,n=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=c(a),u=o,m=h["".concat(i,".").concat(u)]||h[u]||p[u]||n;return a?r.createElement(m,s(s({ref:t},d),{},{components:a})):r.createElement(m,s({ref:t},d))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=a.length,s=new Array(n);s[0]=u;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[h]="string"==typeof e?e:o,s[1]=l;for(var c=2;c<n;c++)s[c]=a[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9341:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>n,metadata:()=>l,toc:()=>c});var r=a(7462),o=(a(7294),a(3905));const n={},s="Solver Landscape",l={unversionedId:"off-chain-services/solvers/type-of-solvers",id:"off-chain-services/solvers/type-of-solvers",title:"Solver Landscape",description:"There are currently multiple solvers competing to come up with the best order settlement solution matching for a given batch auction problem. They can be grouped in a 2x2 matrix:",source:"@site/docs/4_off-chain-services/solvers/2_type-of-solvers.md",sourceDirName:"4_off-chain-services/solvers",slug:"/off-chain-services/solvers/type-of-solvers",permalink:"/cow-docs/docs/off-chain-services/solvers/type-of-solvers",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/4_off-chain-services/solvers/2_type-of-solvers.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Solvers",permalink:"/cow-docs/docs/off-chain-services/solvers/intro"},next:{title:"Solvers Competition",permalink:"/cow-docs/docs/off-chain-services/solvers/solvers-competition"}},i={},c=[{value:"<strong>Baseline solver</strong>",id:"baseline-solver",level:3},{value:"<strong>DEX Aggregator Solvers: 1inch, Paraswap &amp; Matcha</strong>",id:"dex-aggregator-solvers-1inch-paraswap--matcha",level:3},{value:"<strong>Balancer SOR (Smart Order Routing) solver</strong>",id:"balancer-sor-smart-order-routing-solver",level:3},{value:"<strong>Naive solver</strong>",id:"naive-solver",level:3},{value:"CowDexAg solver",id:"cowdexag-solver",level:3},{value:"<strong>MIP solver</strong>",id:"mip-solver",level:3},{value:"Quasimodo solver",id:"quasimodo-solver",level:3}],d={toc:c},h="wrapper";function p(e){let{components:t,...a}=e;return(0,o.kt)(h,(0,r.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"solver-landscape"},"Solver Landscape"),(0,o.kt)("p",null,"There are currently multiple solvers competing to come up with the best order settlement solution matching for a given batch auction problem. They can be grouped in a 2x2 matrix:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null}),(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"Single order solver")),(0,o.kt)("th",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"th"},"Batch order solver")))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"Internal routing")),(0,o.kt)("td",{parentName:"tr",align:null},"Baseline"),(0,o.kt)("td",{parentName:"tr",align:null},"Naive, MIP, Quasimodo")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("strong",{parentName:"td"},"External routing")),(0,o.kt)("td",{parentName:"tr",align:null},"1inch, Paraswap, Matcha, Balancer SOR"),(0,o.kt)("td",{parentName:"tr",align:null},"CowDexAg")))),(0,o.kt)("p",null,"The first dimension being a property of the problem, while the second is a property of the method:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Single/batch order solver:")," Matches one/more than one order at once with a set of AMM's."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Internal/external routing algorithm:")," Uses an internal/external routing algorithm to determine which AMM pools are best to use.")),(0,o.kt)("p",null,"The following briefly describes each of these individual solvers. Throughout, we will use the following graph representation of a batch auction. The nodes represent tokens, blue arrows are orders, and green arrows are AMM pools. A dashed edge indicates an unused AMM. The edge weights stand for the spot exchange rate (sell amount/buy amount) associated with the AMM pool."),(0,o.kt)("h3",{id:"baseline-solver"},(0,o.kt)("strong",{parentName:"h3"},"Baseline solver")),(0,o.kt)("p",null,"The Baseline solver matches a single order to a set of AMM's, by computing the single sequence of AMM's (without splitting across multiple paths) that leads to a higher surplus for the owner of the order."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example:")," A trader would like to buy D for A, at a limit exchange rate A/D <= 1 (blue arrow in the picture below). There are four AMM pools, which operate at the fixed exchange rates as described in the picture (assume there is no slippage for now). If the order is matched against the AMM sequence A->B->D, then the exchange rate D/A would be B/A ","*"," D/B = 0.9 ","*"," 0.8 = 0.72. However, this exchange rate would violate the order limit price (1/0.72 > 1). Therefore, the Baseline solver would match the order against the A->C->D pool sequence instead. Notice that even if the order limit price was 1/0.72, then the solution would not change since the A->C->D sequence leads to a higher surplus for the trader."),(0,o.kt)("p",null,"![](/img/Baseline Solver.png)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prod: ","[https://etherscan.io/address/0x833f076d182123ca8dde2743045ea02957bd61ef]"),(0,o.kt)("li",{parentName:"ul"},"Barn: ","[https://etherscan.io/address/0xbfaf2b5e351586551d8bf461ba5b2b5455b173da]")),(0,o.kt)("h3",{id:"dex-aggregator-solvers-1inch-paraswap--matcha"},(0,o.kt)("strong",{parentName:"h3"},"DEX Aggregator Solvers: 1inch, Paraswap & Matcha")),(0,o.kt)("p",null,"These solvers have a more holistic view of the available on-chain liquidity (the Baseline solver is currently only supporting a limited list of on-chain protocols)."),(0,o.kt)("p",null,"They match each order by using the 1inch, Paraswap & Matcha external API services. This means that both the set of AMM pools (and other liquidity) to consider and the method used to match them against, is outsourced. Note that these solvers' routing algorithm is more advanced than the Baseline solver since it can split an order across multiple AMM sequences, as explained in the following example."),(0,o.kt)("p",null,"![](/img/Balancer SoR Solver.png)"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Example:")," Consider again the previous example from above. Since pools have slippage (the exchange rate changes as a function of the traded amount), if the order being matched is big enough, it could eventually occur that spot exchange rates on the sequence A->C->D would be as shown in the picture above. At this point, it is equally advantageous to use the A->B->D sequence, and in fact, the optimal strategy would be to match the remaining amount to be traded to both sequences simultaneously."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Matcha Prod: ","[https://etherscan.io/address/0xe92f359e6f05564849afa933ce8f62b8007a1d5d]"),(0,o.kt)("li",{parentName:"ul"},"Matcha Barn: ","[https://etherscan.io/address/0x97dd6a023b06ba4722af8af775ec3c2361e66684]"),(0,o.kt)("li",{parentName:"ul"},"Paraswap Prod: ","[https://etherscan.io/address/0x15f4c337122ec23859ec73bec00ab38445e45304]"),(0,o.kt)("li",{parentName:"ul"},"Paraswap Barn: ","[https://etherscan.io/address/0x6372bcbf66656e91b9213b61d861b5e815296207]"),(0,o.kt)("li",{parentName:"ul"},"1Inch Prod: ","[https://etherscan.io/address/0xde1c59bc25d806ad9ddcbe246c4b5e5505645718]"),(0,o.kt)("li",{parentName:"ul"},"1Inch Barn: ","[https://etherscan.io/address/0x8c9d33828dace1eb9fc533ffde88c4a9db115061]")),(0,o.kt)("h3",{id:"balancer-sor-smart-order-routing-solver"},(0,o.kt)("strong",{parentName:"h3"},"Balancer SOR (Smart Order Routing) solver")),(0,o.kt)("p",null,"Matches a single order to the set of pools that are within the Balancer protocol. This means that the set of AMM pools to consider and the method used to match them against the order only relies on what is happening inside the Balancer protocol. Like the other DEX Aggregator solvers, it can match an order using multiple pool sequences."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"TBD")),(0,o.kt)("h3",{id:"naive-solver"},(0,o.kt)("strong",{parentName:"h3"},"Naive solver")),(0,o.kt)("p",null,"Matches a set of orders in a single token pair against a Uniswap v2 - like pool (Sushi, SwapR, etc.). This special case of the general multi-dimensional batch auction problem can be solved very efficiently. It is essentially a two-dimensional orderbook, where the remaining unmatched amounts, which can be positive since orders, fill-or-kill are traded through the AMM pool."),(0,o.kt)("p",null,"![](/img/Niave Solver.png)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prod: ","[https://etherscan.io/address/0x340185114f9d2617dc4c16088d0375d09fee9186]"),(0,o.kt)("li",{parentName:"ul"},"Barn: ","[https://etherscan.io/address/0xb8650702412d0aa7f01f6bee70335a18d6a78e77]")),(0,o.kt)("h3",{id:"cowdexag-solver"},"CowDexAg solver"),(0,o.kt)("p",null,"A batched solver that is leveraging external DEX Aggregators. It uses Paraswap's and 0x's API to get execution paths for each order in the batch. It then checks, if there are any ",(0,o.kt)("em",{parentName:"p"},"coincidences of wants")," in the returned paths (e.g., matching the likely USDC",(0,o.kt)("inlineCode",{parentName:"p"},"<>"),"WETH leg on a USDC",(0,o.kt)("inlineCode",{parentName:"p"},"->"),"GNO and BAL",(0,o.kt)("inlineCode",{parentName:"p"},"->"),"USDC trade). If so, it reduces the trading amount on those hops (leading to better prices for the people involved) and settles all other hops according to the best DEX Aggregator's execution."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Address")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prod: ","[https://etherscan.io/address/0x2d15894fac906386ff7f4bd07fceac43fcf80c73]"),(0,o.kt)("li",{parentName:"ul"},"Barn: ","[https://etherscan.io/address/0x583cd88b9d7926357fe6bddf0e8950557fcda0ca]")),(0,o.kt)("h3",{id:"mip-solver"},(0,o.kt)("strong",{parentName:"h3"},"MIP solver")),(0,o.kt)("p",null,"The MIP solver matches a set of orders against a set of AMM's. This is the general case, which is an NP-hard problem, and is tackled using a mixed-integer programming approach. A previous version of the model, that does not include the AMM integration, is thoroughly described ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/gnosis/dex-research/blob/master/BatchAuctionOptimization/batchauctions.pdf"},"here"),"."),(0,o.kt)("p",null,"![](/img/MIP Solver.png)"),(0,o.kt)("p",null,"At the moment, this solver only has access to Uni v2 style liquidity. More complex AMM's (e.g., Uni v3 style pools) cannot be easily modeled using linear constraints and are therefore not supported by this solver yet."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prod: ","[https://etherscan.io/address/0xf2d21ad3c88170d4ae52bbbeba80cb6078d276f4]"),(0,o.kt)("li",{parentName:"ul"},"Staging: ","[https://etherscan.io/address/0x158261d17d2983b2cbaecc1ae71a34617ae4cb16]")),(0,o.kt)("h3",{id:"quasimodo-solver"},"Quasimodo solver"),(0,o.kt)("p",null,"Unlike the MIP solver, Quasimodo represents liquidity using a quasi-linear program allowing it to also model more sophisticated AMMs (e.g.,. Balancer stable pools). While harder in theory, this problem statement has proven quite effective in practice."),(0,o.kt)("p",null,"Quasimodo relies on the protocol's baseline liquidity but can be extended to use any demand curve that is convex (buying more of a token will lead to a worse price)."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Addresses:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prod: ","[https://etherscan.io/address/0x77ec2a722c2393d3fd64617bbaf1499c713e616b]"),(0,o.kt)("li",{parentName:"ul"},"Staging: ","[https://etherscan.io/address/0x70f3c870b6e7e1d566e40c41e2e3d6e895fcee23]")))}p.isMDXComponent=!0}}]);