"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[6988],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>g});var i=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=i.createContext({}),c=function(e){var t=i.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(r),d=n,g=m["".concat(l,".").concat(d)]||m[d]||p[d]||a;return r?i.createElement(g,o(o({ref:t},u),{},{components:r})):i.createElement(g,o({ref:t},u))}));function g(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,o=new Array(a);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:n,o[1]=s;for(var c=2;c<a;c++)o[c]=r[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,r)}d.displayName="MDXCreateElement"},8186:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var i=r(7462),n=(r(7294),r(3905));const a={},o="2. Signing the Limit Order",s={unversionedId:"tutorials/submit-limit-orders-via-api/submitting-the-limit-order/signing-the-limit-order",id:"tutorials/submit-limit-orders-via-api/submitting-the-limit-order/signing-the-limit-order",title:"2. Signing the Limit Order",description:"We will resume the example from above, setting the validity (Unix timestamp) to August 4th 2021. We use keccak(GPv2 Place Order Tutorial) as appData (you can use your individual 32 bytes to identify the \u201csource\u201d of your orders).",source:"@site/docs/5_tutorials/submit-limit-orders-via-api/submitting-the-limit-order/2.-signing-the-limit-order.md",sourceDirName:"5_tutorials/submit-limit-orders-via-api/submitting-the-limit-order",slug:"/tutorials/submit-limit-orders-via-api/submitting-the-limit-order/signing-the-limit-order",permalink:"/cow-docs/docs/tutorials/submit-limit-orders-via-api/submitting-the-limit-order/signing-the-limit-order",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/5_tutorials/submit-limit-orders-via-api/submitting-the-limit-order/2.-signing-the-limit-order.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"1. Setting Allowance for the sell token",permalink:"/cow-docs/docs/tutorials/submit-limit-orders-via-api/submitting-the-limit-order/setting-allowance-for-the-sell-token"},next:{title:"3. Placing the Limit Order",permalink:"/cow-docs/docs/tutorials/submit-limit-orders-via-api/submitting-the-limit-order/placing-the-limit-order"}},l={},c=[],u={toc:c},m="wrapper";function p(e){let{components:t,...r}=e;return(0,n.kt)(m,(0,i.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"2-signing-the-limit-order"},"2. Signing the Limit Order"),(0,n.kt)("p",null,"We will resume the example from above, setting the validity (Unix timestamp) to",(0,n.kt)("a",{parentName:"p",href:"https://www.epochconverter.com/?q=1628035200"}," August 4th 2021"),". We use keccak(GPv2 Place Order Tutorial) as appData (you can use your individual 32 bytes to identify the \u201csource\u201d of your orders)."),(0,n.kt)("p",null,"Our typescript library provides a convenient way to create valid signatures for your order."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},'import {\n domain,\n Order,\n SigningScheme,\n signOrder,\n OrderKind,\n} from "@gnosis.pm/gp-v2-contracts"\n\u200b\nconst [trader] = await ethers.getSigners();\nconst order = {\n   sellToken: 0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48,\n   buyToken: 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2,\n   sellAmount: 10000000000,\n   buyAmount: 4959721654652700610,\n   validTo: 1628035200,\n   appData: 0xf785fae7a7c5abc49f3cd6a61f6df1ff26433392b066ee9ff2240ff1eb7ab6e4,\n   feeAmount: 0,\n   kind: Sell,\n   partiallyFillable: false,\n   receiver: ethers.constants.AddressZero,\n }\nconst raw_signature = await signOrder(\n     domain(1, \u201d0x9008D19f58AAbD9eD0D60971565AA8510560ab41\u201d),\n     order,\n     trader,\n     SigningScheme.ERC712\n   );\n')),(0,n.kt)("p",null,"// Needed to turn the three part object into a single bytestring"),(0,n.kt)("p",null,"const signature = ethers.utils.joinSignature(rawSignature.data);"),(0,n.kt)("p",null,"If you are using a different programming language you may have to write your own signing logic. Here are some pointers:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u200b",(0,n.kt)("a",{parentName:"li",href:"https://github.com/gnosis/gp-v2-services/blob/d76f23b867e8dbb201f51736c9666e9b18d1086e/model/src/order.rs#L166"},"A reference implementation in rust")," (the domain separator can be queried from the",(0,n.kt)("a",{parentName:"li",href:"https://etherscan.io/address/0x9008D19f58AAbD9eD0D60971565AA8510560ab41#readContract"}," Settlement Contract"),")"),(0,n.kt)("li",{parentName:"ul"},"\u200b",(0,n.kt)("a",{parentName:"li",href:"https://pastebin.com/cKXUz0SW"},"A sample trading bot in python"),"\u200b"),(0,n.kt)("li",{parentName:"ul"},"\u200b",(0,n.kt)("a",{parentName:"li",href:"https://pastebin.com/r787C2wT"},"A sample trading bot in go"),"\u200b")),(0,n.kt)("p",null,"The ultimate source of truth for signature verification is the smart contract\u2019s implementation of the",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-contracts/blob/main/src/contracts/libraries/GPv2Order.sol#L134"}," order digest")," and how it gets verified given",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-contracts/blob/main/src/contracts/mixins/GPv2Signing.sol#L141"}," different signing schemes"),"."),(0,n.kt)("p",null,"Security notice:"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"DO NOT")," sign orders simultaneously with ",(0,n.kt)("strong",{parentName:"p"},"sellAmount == 0, buyAmount == 0, and partiallyFillable == false"),"."),(0,n.kt)("p",null,"\\"))}p.isMDXComponent=!0}}]);