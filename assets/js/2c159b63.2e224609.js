"use strict";(self.webpackChunkcow_docs=self.webpackChunkcow_docs||[]).push([[1879],{3905:(e,t,r)=>{r.d(t,{Zo:()=>f,kt:()=>u});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=o.createContext({}),h=function(e){var t=o.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},f=function(e){var t=h(e.components);return o.createElement(c.Provider,{value:t},e.children)},l="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,f=s(e,["components","mdxType","originalType","parentName"]),l=h(r),d=n,u=l["".concat(c,".").concat(d)]||l[d]||p[d]||i;return r?o.createElement(u,a(a({ref:t},f),{},{components:r})):o.createElement(u,a({ref:t},f))}));function u(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[l]="string"==typeof e?e:n,a[1]=s;for(var h=2;h<i;h++)a[h]=r[h];return o.createElement.apply(null,a)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"},9421:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>h});var o=r(7462),n=(r(7294),r(3905));const i={},a="Fee Mechanism",s={unversionedId:"off-chain-services/api/fee-mechanism",id:"off-chain-services/api/fee-mechanism",title:"Fee Mechanism",description:'For the purposes of this page, any instance of the word "fee" shall be taken to mean "protocol fee" per the definitions.',source:"@site/docs/4_off-chain-services/api/2_fee-mechanism.md",sourceDirName:"4_off-chain-services/api",slug:"/off-chain-services/api/fee-mechanism",permalink:"/cow-docs/docs/off-chain-services/api/fee-mechanism",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/4_off-chain-services/api/2_fee-mechanism.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"API",permalink:"/cow-docs/docs/off-chain-services/api/intro"},next:{title:"Price Estimation",permalink:"/cow-docs/docs/off-chain-services/api/price-estimation"}},c={},h=[],f={toc:h},l="wrapper";function p(e){let{components:t,...r}=e;return(0,n.kt)(l,(0,o.Z)({},f,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"fee-mechanism"},"Fee Mechanism"),(0,n.kt)("admonition",{type:"caution"},(0,n.kt)("p",{parentName:"admonition"},'For the purposes of this page, any instance of the word "fee" shall be taken to mean "protocol fee" per the ',(0,n.kt)("a",{parentName:"p",href:"../../overview/definitions"},"definitions"),".")),(0,n.kt)("p",null,"In CoW Protocol, the blockchain transactions that settle user orders are submitted by the settlement backend run by the solvers, which incurs gas costs. This cost is forwarded to orders in the form of protocol fees. The aim of this protocol fee is for the solvers to cover the costs of executing the order within a batch auction."),(0,n.kt)("p",null,'As you know, CoW Protocol works with off-chain transactions in the form of signed orders. These orders contain a field called "feeAmount" which is the maximum amount of fees that can be charged to the owner of the order. When the order gets executed, the fee is enforced by the settlement smart contract and given to the backend solver that submitted the settlement solution that contained such an order.'),(0,n.kt)("p",null,"In the smart contract, the fee is taken from the order's sell token. As Ethereum's gas price and the relative price between the sell token and buy token change, so does the minimum fee that makes it viable for a solver to include an order. Because of changing conditions, CoW Protocol is able to execute orders in a full or partial style, meaning that if the order is completely filled, the fee taken by the protocol is 100%, while if the order is partially executed, a prorated amount of the total fee is taken."),(0,n.kt)("p",null,"This is communicated through the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-services/blob/main/orderbook/src/api/get_fee_and_quote.rs"},"/api/v1/feeAndQuote"),"  endpoint. Based on the order's type, sell token, buy token, and amount, the backend calculates an acceptable fee and a validity period. When submission of a new order is attempted, the backend checks if the fee is appropriate and rejects the order if the fee is not sufficient. The validity period improves the user experience by guaranteeing that order submission with this fee will not be rejected for some time. Otherwise, the price could move and by the time a user has signed their order, it would get rejected."),(0,n.kt)("p",null,"Once accepted the order is expected to be executed even if gas prices change (this might change in the future)."),(0,n.kt)("p",null,"Fee estimation estimates the amount of gas needed on a per order basis taking into account that for some token pairs the route through automated market makers like Uniswap pools is longer than for others. Fee estimation is handled in ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-services/blob/main/orderbook/src/fee.rs"},"orderbook/src/fee.rs")),(0,n.kt)("p",null,"Fees are persisted in the min","_","fee","_","measurements postgres table from which we can efficiently look up valid fees and discard expired fees. Fee Persistence is handled in ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/gnosis/gp-v2-services/blob/main/orderbook/src/database/fees.rs"},"orderbook/src/database/fees.rs")))}p.isMDXComponent=!0}}]);