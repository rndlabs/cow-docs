<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/how-to-write-a-solver">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">How to write a solver | CoW Protocol Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.cow.fi/cow-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.cow.fi/cow-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.cow.fi/cow-docs/docs/tutorials/how-to-write-a-solver"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How to write a solver | CoW Protocol Docs"><meta data-rh="true" name="description" content="This tutorial was fully composed by poolpitako, link to the original tutorial doc can be found here"><meta data-rh="true" property="og:description" content="This tutorial was fully composed by poolpitako, link to the original tutorial doc can be found here"><link data-rh="true" rel="icon" href="/cow-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.cow.fi/cow-docs/docs/tutorials/how-to-write-a-solver"><link data-rh="true" rel="alternate" href="https://docs.cow.fi/cow-docs/docs/tutorials/how-to-write-a-solver" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.cow.fi/cow-docs/docs/tutorials/how-to-write-a-solver" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/cow-docs/assets/css/styles.0aaf4738.css">
<link rel="preload" href="/cow-docs/assets/js/runtime~main.e436a8e8.js" as="script">
<link rel="preload" href="/cow-docs/assets/js/main.86a37763.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cow-docs/"><div class="navbar__logo"><img src="/cow-docs/img/logo.svg" alt="Coooooooow" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cow-docs/img/logo.svg" alt="Coooooooow" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Cow Protocol Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cow-docs/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/cowprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cow-docs/docs/intro">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cow-docs/docs/category/overview">Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cow-docs/docs/category/front-end">Front-end</a><button aria-label="Toggle the collapsible sidebar category &#x27;Front-end&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cow-docs/docs/category/smart-contracts">Smart Contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Smart Contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cow-docs/docs/category/off-chain-services">Off Chain Services</a><button aria-label="Toggle the collapsible sidebar category &#x27;Off Chain Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/cow-docs/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cow-docs/docs/category/on-chain-order-cancellation">On-chain Order Cancellation</a><button aria-label="Toggle the collapsible sidebar category &#x27;On-chain Order Cancellation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cow-docs/docs/category/submitting-orders-to-the-api">Submitting orders to the API</a><button aria-label="Toggle the collapsible sidebar category &#x27;Submitting orders to the API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cow-docs/docs/category/submitting-limit-orders-to-the-api">Submitting Limit orders to the API</a><button aria-label="Toggle the collapsible sidebar category &#x27;Submitting Limit orders to the API&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cow-docs/docs/category/cow-protocol-trades-with-a-gnosis-safe-wallet">CoW Protocol trades with a Gnosis Safe Wallet</a><button aria-label="Toggle the collapsible sidebar category &#x27;CoW Protocol trades with a Gnosis Safe Wallet&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cow-docs/docs/tutorials/how-to-test-a-solver-locally">How to test a solver locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cow-docs/docs/tutorials/solver-workshop">Solver Workshop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cow-docs/docs/tutorials/how-to-write-a-solver">How to write a solver</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cow-docs/docs/category/how-to-place-erc-1271-smart-contract-orders">How to place ERC-1271 (Smart Contract) orders</a><button aria-label="Toggle the collapsible sidebar category &#x27;How to place ERC-1271 (Smart Contract) orders&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cow-docs/docs/tutorials/build-on-top-of-cow-protocol">Build on top of CoW Protocol</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/cow-docs/docs/category/cow-sdk">CoW SDK</a><button aria-label="Toggle the collapsible sidebar category &#x27;CoW SDK&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cow-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cow-docs/docs/category/tutorials"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How to write a solver</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How to write a solver</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="this-tutorial-was-fully-composed-by-poolpitako-link-to-the-original-tutorial-doc-can-be-found-here">This tutorial was fully composed by <a href="https://twitter.com/poolpitako" target="_blank" rel="noopener noreferrer">poolpitako</a>, link to the original tutorial doc can be found <a href="https://hackmd.io/Qx3i17ZMRLSFFNyw0tn8sQ?view" target="_blank" rel="noopener noreferrer">here</a><a href="#this-tutorial-was-fully-composed-by-poolpitako-link-to-the-original-tutorial-doc-can-be-found-here" class="hash-link" aria-label="Direct link to this-tutorial-was-fully-composed-by-poolpitako-link-to-the-original-tutorial-doc-can-be-found-here" title="Direct link to this-tutorial-was-fully-composed-by-poolpitako-link-to-the-original-tutorial-doc-can-be-found-here">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="idea-">Idea <a href="#idea" id="idea"></a><a href="#idea-" class="hash-link" aria-label="Direct link to idea-" title="Direct link to idea-">​</a></h3><p>I wanted to start with something super basic to understand all the moving pieces. In my example, I am going to build a solver for Yearn tokens. User has a token, let’s say, <code>USDC</code> and wants to buy <code>yvUSDC</code>. Right now, CoW Swap would need a LP <code>USDC/yvUSDC</code> to settle the trade, but what if the solver understands how to deposit into a yearn vault? <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/thinking_face.png" alt=":thinking_face:" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-big-picture-">The Big Picture <a href="#the-big-picture" id="the-big-picture"></a><a href="#the-big-picture-" class="hash-link" aria-label="Direct link to the-big-picture-" title="Direct link to the-big-picture-">​</a></h3><p>CoW Swap infrastructure is a lot of services running together, which is a bit intimidating at the beginning. Here’s the ELI5 of how CoW Swap works and it’s entities.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-orderbook-">The Orderbook <a href="#the-orderbook" id="the-orderbook"></a><a href="#the-orderbook-" class="hash-link" aria-label="Direct link to the-orderbook-" title="Direct link to the-orderbook-">​</a></h4><p>The orderbook is a service that uses a database to stores trades.\
When you go to <a href="https://swap.cow.fi/" target="_blank" rel="noopener noreferrer">https://swap.cow.fi/</a> and create a trade, the website uses the orderbook API to add the trade to the database. If the trade is ready to go (it might be created but missing a signature), it will be listed in the <code>solvable_orders</code> endpoint.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-driver-">The Driver <a href="#the-driver" id="the-driver"></a><a href="#the-driver-" class="hash-link" aria-label="Direct link to the-driver-" title="Direct link to the-driver-">​</a></h4><p>The driver is a polling service that queries the orderbook API for orders and tries to settle them using the different solvers. The driver calls different solvers by using an http API. The driver prunes the orderbook <code>solvable_orders</code> and sends orders, in json, to the different solvers. If a solver finds a solution to the batch, the driver executes the trade on chain.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="solver-">Solver <a href="#solver" id="solver"></a><a href="#solver-" class="hash-link" aria-label="Direct link to solver-" title="Direct link to solver-">​</a></h4><p>The solver is a standalone service which receives a json with orders and tries to settle them.\
The settlement can be a list of actions which are executed by the settlement contract on chain.</p><p><strong>Warning</strong>: I assume you have rust setup correctly with rustup.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-most-basic-setup-">The most basic setup <a href="#the-most-basic-setup" id="the-most-basic-setup"></a><a href="#the-most-basic-setup-" class="hash-link" aria-label="Direct link to the-most-basic-setup-" title="Direct link to the-most-basic-setup-">​</a></h3><p>Let’s start simple. Let’s first run a solver which solves a json we send by hand with curl.</p><p>Start by cloning <a href="https://github.com/gnosis/cow-dex-solver" target="_blank" rel="noopener noreferrer">https://github.com/gnosis/cow-dex-solver</a></p><p>cow-dex-solver will give you a good idea of how a solver service is architectured.\
You have a method called <code>solve()</code> which receives the batch <code>orders</code> and returns a <code>SettledBatchAuctionModel</code> aka a solution.</p><p>To run, exec:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run -v </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the service is running you can start throwing jsons at it.\
I started reading the code and playing with different json setups calling:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -vX POST &quot;http://127.0.0.1:8000/solve&quot; -H  &quot;accept: application/json&quot; -H  &quot;Content-Type: application/json&quot; --data &quot;@/Users/user/dev/cow-dex-solver/sample.json&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can get some inspiration from prod examples here:\
<a href="http://gnosis-europe-gpv2-solver.s3-website.eu-central-1.amazonaws.com/index.html#data/prod/2022/01/" target="_blank" rel="noopener noreferrer">http://gnosis-europe-gpv2-solver.s3-website.eu-central-1.amazonaws.com/index.html#data/prod/2022/01/</a></p><p>Make sure to test what happens when there is a CoW <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow.png" alt=":cow:" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="settling-real-orders-">Settling Real Orders <a href="#settling-real-orders" id="settling-real-orders"></a><a href="#settling-real-orders-" class="hash-link" aria-label="Direct link to settling-real-orders-" title="Direct link to settling-real-orders-">​</a></h3><p>Once I understood how a solver works, I wanted to solve a real order. To test this out without setting up the orderbook I used a little trick. I created an order in a production orderbook but I setup an impossible limit order. For that I used the staging orderbook in the gnosis-chain. I deployed a yvUSDC vault, and I created an LP USDC/yvUSDC in Honeyswap.</p><p>You have different options to create a limit oder:</p><ul><li><a href="https://docs.cow.fi/tutorials/cowswap-trades-with-a-gnosis-safe-wallet" target="_blank" rel="noopener noreferrer">https://docs.cow.fi/tutorials/cowswap-trades-with-a-gnosis-safe-wallet</a></li><li><a href="https://bafybeias5x3tgdshkhj5umriqze2wioy5mjw4fdo2zzp2sl4pacq7rnwtm.ipfs.infura-ipfs.io/?orderbook=https://barn.api.cow.fi/xdai" target="_blank" rel="noopener noreferrer">https://bafybeias5x3tgdshkhj5umriqze2wioy5mjw4fdo2zzp2sl4pacq7rnwtm.ipfs.infura-ipfs.io/?orderbook=https://barn.api.cow.fi/xdai</a></li><li>You call the api by hand</li></ul><p>Here’s the example I created while testing:\
<a href="https://barn.gnosis-protocol.io/gc/orders/0xcc37de3ba70474948f838e8b4af9c6b66577c08202323a4a3060a645b2918dae2813a7e97fd0bc1b80cb63afe136510d940ddc236208633c" target="_blank" rel="noopener noreferrer">https://barn.gnosis-protocol.io/gc/orders/0xcc37de3ba70474948f838e8b4af9c6b66577c08202323a4a3060a645b2918dae2813a7e97fd0bc1b80cb63afe136510d940ddc236208633c</a></p><p>I am trading 10 USDC for 91.412 yvUSDC, which of course, will never settle by regular solvers since 1 <code>USDC == 1 yvUSDC</code> (price per share is 1).</p><p>Now that we have the real order, the orderbook will return it in the <code>solvable_orders</code> endpoint.\
To consume it, we will need to use the driver.</p><p>the cow-dex-solver repo now has a nice README with an explanation of how to run the driver:\
<a href="https://github.com/gnosis/cow-dex-solver#how-to-run-simulations-together-with-the-cowswap-official-driver" target="_blank" rel="noopener noreferrer">https://github.com/gnosis/cow-dex-solver#how-to-run-simulations-together-with-the-cowswap-official-driver</a></p><p>The way I was it running was:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run -p solver --  --orderbook-url https://protocol-xdai.dev.gnosisdev.com \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --base-tokens 0xDDAfbb505ad214D7b80b1f830fcCc89B60fb7A83 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --node-url &quot;https://rpc.xdaichain.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --cow-dex-ag-solver-url &quot;http://127.0.0.1:8000&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --solver-account 0x7942a2b3540d1ec40b2740896f87aecb2a588731 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --solvers CowDexAg \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --transaction-strategy DryRun</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A small explanation of the parameters:</p><ul><li><strong>orderbook-url</strong>: points to the gnosis staging version</li><li><strong>node-url</strong> connects to gnosis-chain (VERY IMPORTANT, liquidity sources are based on this)</li><li><strong>cow-dex-ag-solver-url</strong> our running solver instance</li><li><strong>solver-account</strong> An address that has permissions to run txs in the settlement contract</li><li><strong>solvers</strong> just use our CowDexAg instance</li><li><strong>transaction-strategy</strong> DryRun will give us a tenderly link after running</li></ul><p>If you got to this point, you have 99% of stuff you need to write your solver.\
Until the trade expires, the solver will always find the crazy limit order and send it to your solver. If the solver responds with a solution, the driver will spit out a tenderly link with the execution simulation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="full-e2e-testing-">Full E2E testing <a href="#full-e2e-testing" id="full-e2e-testing"></a><a href="#full-e2e-testing-" class="hash-link" aria-label="Direct link to full-e2e-testing-" title="Direct link to full-e2e-testing-">​</a></h3><p>Is your solver working and you want to try a more real order?\
You will need to run your own orderbook. For that, you will need docker.\
Follow the steps at: <a href="https://github.com/gnosis/gp-v2-services/#db-migrationinitialization" target="_blank" rel="noopener noreferrer">https://github.com/gnosis/gp-v2-services/#db-migrationinitialization</a></p><p>I run my orderbook with:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run --bin orderbook -- \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --skip-trace-api true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --skip-event-sync \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --base-tokens 0xDDAfbb505ad214D7b80b1f830fcCc89B60fb7A83 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-presign-orders true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-url &quot;https://rpc.xdaichain.com&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and created an order using <a href="https://bafybeias5x3tgdshkhj5umriqze2wioy5mjw4fdo2zzp2sl4pacq7rnwtm.ipfs.infura-ipfs.io/?orderbook=http://localhost:8080" target="_blank" rel="noopener noreferrer">https://bafybeias5x3tgdshkhj5umriqze2wioy5mjw4fdo2zzp2sl4pacq7rnwtm.ipfs.infura-ipfs.io/?orderbook=http://localhost:8080</a></p><p>The last step is connecting the driver to the new orderbook local service doing:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run -p solver --  --orderbook-url http://localhost:8080 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --base-tokens 0xDDAfbb505ad214D7b80b1f830fcCc89B60fb7A83 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --node-url &quot;https://rpc.xdaichain.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --cow-dex-ag-solver-url &quot;http://127.0.0.1:8000&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --solver-account 0x7942a2b3540d1ec40b2740896f87aecb2a588731 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --solvers CowDexAg \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --transaction-strategy DryRun</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Full process will be:</p><ul><li>Orderbook at <a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">http://localhost:8080</a> is returning your oder in the <code>solvable_orders</code> endpoint</li><li>Driver will fetch orders from your orderbook and query your</li><li>Solver at <a href="http://localhost:8000/" target="_blank" rel="noopener noreferrer">http://localhost:8000</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="my-solver-code-">My solver code <a href="#my-solver-code" id="my-solver-code"></a><a href="#my-solver-code-" class="hash-link" aria-label="Direct link to my-solver-code-" title="Direct link to my-solver-code-">​</a></h3><p>I forked cow-dex-solver and wrote my first lines of rust.\
You can checkout my solver’s code at:\
<a href="https://github.com/poolpitako/cow-dex-solver/pull/1" target="_blank" rel="noopener noreferrer">https://github.com/poolpitako/cow-dex-solver/pull/1</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion-">Conclusion <a href="#conclusion" id="conclusion"></a><a href="#conclusion-" class="hash-link" aria-label="Direct link to conclusion-" title="Direct link to conclusion-">​</a></h3><p>While there are several services you need to run for an e2e testing, I gotta say I enjoyed developing this prototype. I believe that in the future CoW Swap will not only be used for regular trades but it will be used for settling positions. Want to add liquidity to a curve pool in a single click? Go to CoW Swap. Want to swap your DAI for two yearn vault positions, go to CoW Swap.\
<img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"> <img loading="lazy" src="https://assets.hackmd.io/build/emojify.js/dist/images/basic/cow2.png" alt=":cow2:" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/5_tutorials/7_how-to-write-a-solver.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cow-docs/docs/tutorials/solver-workshop"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Solver Workshop</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cow-docs/docs/category/how-to-place-erc-1271-smart-contract-orders"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to place ERC-1271 (Smart Contract) orders</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#this-tutorial-was-fully-composed-by-poolpitako-link-to-the-original-tutorial-doc-can-be-found-here" class="table-of-contents__link toc-highlight">This tutorial was fully composed by poolpitako, link to the original tutorial doc can be found here</a><ul><li><a href="#idea-" class="table-of-contents__link toc-highlight">Idea <a href="#idea" id="idea"></a></a></li><li><a href="#the-big-picture-" class="table-of-contents__link toc-highlight">The Big Picture <a href="#the-big-picture" id="the-big-picture"></a></a></li><li><a href="#the-most-basic-setup-" class="table-of-contents__link toc-highlight">The most basic setup <a href="#the-most-basic-setup" id="the-most-basic-setup"></a></a></li><li><a href="#settling-real-orders-" class="table-of-contents__link toc-highlight">Settling Real Orders <a href="#settling-real-orders" id="settling-real-orders"></a></a></li><li><a href="#full-e2e-testing-" class="table-of-contents__link toc-highlight">Full E2E testing <a href="#full-e2e-testing" id="full-e2e-testing"></a></a></li><li><a href="#my-solver-code-" class="table-of-contents__link toc-highlight">My solver code <a href="#my-solver-code" id="my-solver-code"></a></a></li><li><a href="#conclusion-" class="table-of-contents__link toc-highlight">Conclusion <a href="#conclusion" id="conclusion"></a></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cow-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ethereum.stackexchange.com/questions/tagged/cow-protocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/cowprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/CoWSwap" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/cowprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 CoW Protocol. Built with Docusaurus.</div></div></div></footer></div>
<script src="/cow-docs/assets/js/runtime~main.e436a8e8.js"></script>
<script src="/cow-docs/assets/js/main.86a37763.js"></script>
</body>
</html>